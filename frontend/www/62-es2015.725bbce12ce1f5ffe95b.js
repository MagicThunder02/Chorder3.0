(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{Ugot:function(t,n,i){"use strict";i.r(n),i.d(n,"ChordmakerPageModule",function(){return T});var o=i("ofXK"),e=i("3Pt+"),c=i("TEn/"),s=i("sYmb"),b=i("99Un"),r=i("tk/3"),l=i("HU+/"),a=i("tyNb"),h=i("mrSG"),d=i("dy81"),f=i("XlTo"),u=i("gkyA"),g=i("4WDQ"),p=i("90kD"),m=i("fXoL");function x(t,n){if(1&t){const t=m.Nb();m.Mb(0,"ion-col",6),m.Mb(1,"ion-button",7),m.Ub("click",function(){m.gc(t);const i=n.$implicit;return m.Wb().selectTile(i)}),m.Mb(2,"ion-text",8),m.oc(3),m.Xb(4,"musicNotation"),m.Lb(),m.Lb(),m.Lb()}if(2&t){const t=n.$implicit;m.xb(1),m.bc("color",t.color),m.xb(2),m.qc(" ",m.Yb(4,2,t.name)," ")}}function y(t,n){if(1&t&&(m.Mb(0,"ion-text"),m.oc(1),m.Xb(2,"translate"),m.Xb(3,"musicNotation"),m.Lb()),2&t){const t=n.$implicit;m.xb(1),m.qc(" ",m.Yb(2,1,m.Yb(3,3,t))," ")}}function M(t,n){if(1&t&&(m.Mb(0,"ion-card-subtitle",14),m.mc(1,y,4,5,"ion-text",15),m.Lb()),2&t){const t=m.Wb().$implicit;m.xb(1),m.bc("ngForOf",t.name)}}function I(t,n){if(1&t&&(m.Mb(0,"ion-text"),m.oc(1),m.Xb(2,"translate"),m.Xb(3,"musicNotation"),m.Ib(4,"br"),m.Lb()),2&t){const t=m.Wb(2).$implicit;m.xb(1),m.rc("",m.Yb(2,2,"tonic"),": ",m.Yb(3,4,t.tonic)," ")}}function L(t,n){if(1&t&&(m.Mb(0,"ion-text"),m.oc(1),m.Xb(2,"translate"),m.Xb(3,"musicNotation"),m.Ib(4,"br"),m.Lb()),2&t){const t=m.Wb(2).$implicit;m.xb(1),m.rc("",m.Yb(2,2,"root"),": ",m.Yb(3,4,t.root),"")}}function W(t,n){if(1&t&&(m.Mb(0,"ion-text"),m.oc(1),m.Xb(2,"translate"),m.Ib(3,"br"),m.Lb()),2&t){const t=m.Wb(2).$implicit,n=m.Wb();m.xb(1),m.rc("",m.Yb(2,2,"intervals"),": ",n.beautify(t.intervals,!1)," ")}}function k(t,n){if(1&t&&(m.Mb(0,"ion-text"),m.oc(1),m.Xb(2,"translate"),m.Ib(3,"br"),m.Lb()),2&t){const t=m.Wb(2).$implicit;m.xb(1),m.rc(" ",m.Yb(2,2,"type"),": ",t.type," ")}}function w(t,n){if(1&t&&(m.Mb(0,"ion-text"),m.oc(1),m.Xb(2,"translate"),m.Ib(3,"br"),m.Ib(4,"br"),m.Lb()),2&t){const t=m.Wb(2).$implicit,n=m.Wb();m.xb(1),m.rc(" ",m.Yb(2,2,"aliases"),": ",n.beautify(t.aliases)," ")}}function C(t,n){if(1&t){const t=m.Nb();m.Mb(0,"ion-icon",22),m.Ub("click",function(){return m.gc(t),m.Wb(5).expandExtensions=!0}),m.Lb()}}function E(t,n){if(1&t&&(m.Mb(0,"ion-text",20),m.oc(1),m.Xb(2,"translate"),m.mc(3,C,1,0,"ion-icon",21),m.Ib(4,"br"),m.Lb()),2&t){const t=m.Wb(3).$implicit,n=m.Wb();m.xb(1),m.rc(" ",m.Yb(2,3,"extensions"),": ",n.beautify(t.extensions.slice(0,3))," "),m.xb(2),m.bc("ngIf",t.extensions.length>3)}}function $(t,n){if(1&t&&(m.Kb(0),m.mc(1,E,5,5,"ion-text",19),m.Jb()),2&t){const t=m.Wb(2).$implicit;m.xb(1),m.bc("ngIf",""!=t.extensions)}}function X(t,n){if(1&t&&(m.Mb(0,"ion-text",20),m.oc(1),m.Xb(2,"translate"),m.Lb()),2&t){const t=m.Wb(3).$implicit,n=m.Wb();m.xb(1),m.rc(" ",m.Yb(2,2,"extensions"),": ",n.beautify(t.extensions)," ")}}function v(t,n){if(1&t){const t=m.Nb();m.Mb(0,"ion-icon",24),m.Ub("click",function(){return m.gc(t),m.Wb(4).expandExtensions=!1}),m.Lb()}}function Y(t,n){if(1&t&&(m.Kb(0),m.mc(1,X,3,4,"ion-text",19),m.mc(2,v,1,0,"ion-icon",23),m.Ib(3,"br"),m.Jb()),2&t){const t=m.Wb(2).$implicit;m.xb(1),m.bc("ngIf",""!=t.extensions),m.xb(1),m.bc("ngIf",t.extensions.length>3)}}function F(t,n){if(1&t){const t=m.Nb();m.Mb(0,"ion-icon",22),m.Ub("click",function(){return m.gc(t),m.Wb(5).expandReduction=!0}),m.Lb()}}function N(t,n){if(1&t&&(m.Mb(0,"ion-text",20),m.oc(1),m.Xb(2,"translate"),m.mc(3,F,1,0,"ion-icon",21),m.Ib(4,"br"),m.Lb()),2&t){const t=m.Wb(3).$implicit,n=m.Wb();m.xb(1),m.rc(" ",m.Yb(2,3,"reductions"),": ",n.beautify(t.reductions.slice(0,3))," "),m.xb(2),m.bc("ngIf",t.reductions.length>3)}}function O(t,n){if(1&t&&(m.Kb(0),m.mc(1,N,5,5,"ion-text",19),m.Jb()),2&t){const t=m.Wb(2).$implicit;m.xb(1),m.bc("ngIf",""!=t.reductions)}}function P(t,n){if(1&t&&(m.Mb(0,"ion-text",20),m.oc(1),m.Xb(2,"translate"),m.Lb()),2&t){const t=m.Wb(3).$implicit,n=m.Wb();m.xb(1),m.rc(" ",m.Yb(2,2,"reductions"),": ",n.beautify(t.reductions)," ")}}function A(t,n){if(1&t){const t=m.Nb();m.Mb(0,"ion-icon",24),m.Ub("click",function(){return m.gc(t),m.Wb(4).expandReduction=!1}),m.Lb()}}function U(t,n){if(1&t&&(m.Kb(0),m.mc(1,P,3,4,"ion-text",19),m.mc(2,A,1,0,"ion-icon",23),m.Jb()),2&t){const t=m.Wb(2).$implicit;m.xb(1),m.bc("ngIf",""!=t.reductions),m.xb(1),m.bc("ngIf",t.reductions.length>3)}}const D=function(){return[]};function z(t,n){if(1&t){const t=m.Nb();m.Mb(0,"ion-card-content",16),m.mc(1,I,5,6,"ion-text",17),m.mc(2,L,5,6,"ion-text",17),m.mc(3,W,4,4,"ion-text",17),m.mc(4,k,4,4,"ion-text",17),m.mc(5,w,5,4,"ion-text",17),m.mc(6,$,2,1,"ng-container",17),m.mc(7,Y,4,2,"ng-container",17),m.mc(8,O,2,1,"ng-container",17),m.mc(9,U,3,2,"ng-container",17),m.Ib(10,"br"),m.Mb(11,"ion-button",18),m.Ub("click",function(){m.gc(t);const n=m.Wb().$implicit;return m.Wb().playChord(n,"chord")}),m.oc(12),m.Xb(13,"translate"),m.Lb(),m.Mb(14,"ion-button",18),m.Ub("click",function(){m.gc(t);const n=m.Wb().$implicit;return m.Wb().playChord(n,"arp")}),m.oc(15),m.Xb(16,"translate"),m.Lb(),m.Lb()}if(2&t){const t=m.Wb().$implicit,n=m.Wb();m.xb(1),m.bc("ngIf",t.tonic),m.xb(1),m.bc("ngIf",t.root),m.xb(1),m.bc("ngIf",""!=t.intervals),m.xb(1),m.bc("ngIf",t.type),m.xb(1),m.bc("ngIf",t.aliases!=m.cc(15,D)),m.xb(1),m.bc("ngIf",!n.expandExtensions),m.xb(1),m.bc("ngIf",n.expandExtensions),m.xb(1),m.bc("ngIf",!n.expandReduction),m.xb(1),m.bc("ngIf",n.expandReduction),m.xb(3),m.qc(" ",m.Yb(13,11,"play_chord")," "),m.xb(3),m.qc(" ",m.Yb(16,13,"play_arp")," ")}}function _(t,n){if(1&t){const t=m.Nb();m.Mb(0,"ion-card",9),m.Mb(1,"ion-card-header",10),m.Ub("click",function(){m.gc(t);const i=n.$implicit;return m.Wb().toggleCard(i)}),m.Mb(2,"ion-card-title",11),m.oc(3),m.Xb(4,"musicNotation"),m.Lb(),m.mc(5,M,2,1,"ion-card-subtitle",12),m.Lb(),m.mc(6,z,17,16,"ion-card-content",13),m.Lb()}if(2&t){const t=n.$implicit;m.xb(3),m.pc(m.Yb(4,3,t.symbol)),m.xb(2),m.bc("ngIf",t.show),m.xb(1),m.bc("ngIf",t.show)}}let q=(()=>{class t{constructor(t,n,i){this.translate=t,this.global=n,this.modalCtrl=i,this.musicNotationPipe=new u.a(this.global),this.translatePipe=new s.c(this.translate,null),this.tiles=[],this.notes=[],this.chords=[],this.expandReduction=!1,this.expandExtensions=!1,this.synth=new f.c({urls:{A2:"pianoA2.wav"},baseUrl:"assets/instruments/"}).toDestination()}selectTile(t){this.chords=[],this.toggleTile(t),this.checkEquals(t),this.colorTiles(),this.findChord()}selectInstrument(){this.synth="",console.log(this.global.instrument),this.synth=new f.c({urls:{A2:this.global.instrument+"A2.wav"},baseUrl:"assets/instruments/"}).toDestination()}toggleTile(t){t.selected=0==t.selected}checkEquals(t){this.tiles.forEach(n=>{let i=d.b.distance(t.name,n.name);"0A"!=i&&"2d"!=i||(n.selected=!1)})}colorTiles(){this.tiles.forEach(t=>{t.color=t.selected?"secondary":"light"})}findChord(){this.notes=[],this.tiles.forEach(t=>{t.selected&&this.notes.push(t.name)}),this.notes.length>=3&&(d.a.detect(this.notes).forEach((t,n)=>{if(this.chords.push({symbol:t}),!t.includes("/")||1!=t.split("/")[1].length&&2!=t.split("/")[1].length){let i=d.a.get(t);this.chords[n].name=i.name.split(" "),this.chords[n].root=i.root,this.chords[n].intervals=i.intervals,this.chords[n].aliases=i.aliases,this.chords[n].notes=i.notes,this.chords[n].type=i.type,this.chords[n].tonic=i.tonic}else{let i=t.split("/")[0],o=d.a.get(i);this.chords[n].name=(o.name+" slash "+t.split("/")[1]).split(" "),this.chords[n].root=t.split("/")[1],this.chords[n].intervals=o.intervals,this.chords[n].type=o.type+" slashed",this.chords[n].tonic=o.tonic,this.chords[n].notes=o.notes,this.chords[n].notes.push(t.split("/")[1])}this.chords[n].extensions=d.a.extended(t),this.chords[n].reductions=d.a.reduced(t),this.chords.forEach(t=>{t.show=!1})}),console.log(this.chords))}toggleCard(t){t.show=0==t.show}playChord(t,n){let i=["Cb","C","C#","Db","D","D#","Eb","E","E#","Fb","F","F#","Gb","G","G#","Ab","A","A#","Bb","B","B#"],o=t.notes.map(function(n,o){if(n.includes("##")){let t=i.indexOf(n.slice(0,-1));n=i[(t+2)%i.length]}if(n.includes("bb")){let t=i.indexOf(n);n=i[(t-2)%i.length]}return parseInt(t.intervals[o],10)<=7?n+"3":n+"4"});"arp"==n?o.forEach((t,n)=>{this.synth.triggerAttackRelease(t,"4n",f.e()+n/2)}):"chord"==n&&this.synth.triggerAttackRelease(o,"2n")}beautify(t,n=!0){let i="";switch(n){case!0:if(t)return t.forEach((n,o)=>{0!=o&&o!=t.length&&""!=n?i=i+", "+this.musicNotationPipe.transform(n):i+=this.musicNotationPipe.transform(n)}),i;break;case!1:return t.forEach((n,o)=>{0!=o&&o!=t.length&&""!=n?i=i+", "+n:i+=n}),i}}ionViewDidEnter(){this.selectInstrument()}ngOnInit(){["Cb","C","C#","Db","D","D#","Eb","E","E#","Fb","F","F#","Gb","G","G#","Ab","A","A#","Bb","B","B#"].forEach((t,n)=>{this.tiles.push({name:t,color:"light",selected:!1})}),console.log(this.tiles)}openModal(){return Object(h.a)(this,void 0,void 0,function*(){const t=yield this.modalCtrl.create({component:p.a,componentProps:{pageName:"chordmaker"},cssClass:"fullscreen"});yield t.present()})}}return t.\u0275fac=function(n){return new(n||t)(m.Hb(s.d),m.Hb(g.a),m.Hb(c.P))},t.\u0275cmp=m.Bb({type:t,selectors:[["app-chordmaker"]],decls:14,vars:5,consts:[["slot","start"],["lines","none"],[2,"padding","0","text-align","left"],["name","information-circle-outline","color","medium","size","large","slot","end",3,"click"],["size","4","class","col-tiles",4,"ngFor","ngForOf"],["style","border: 1px solid grey;",4,"ngFor","ngForOf"],["size","4",1,"col-tiles"],[1,"button-tiles",3,"color","click"],[1,"button-title"],[2,"border","1px solid grey"],[3,"click"],[1,"card-title"],["class","card-subtitle",4,"ngIf"],["class","card-content",4,"ngIf"],[1,"card-subtitle"],[4,"ngFor","ngForOf"],[1,"card-content"],[4,"ngIf"],["color","secondary",3,"click"],["class","center",4,"ngIf"],[1,"center"],["name","ellipsis-horizontal","style","padding-left: 3%;",3,"click",4,"ngIf"],["name","ellipsis-horizontal",2,"padding-left","3%",3,"click"],["name","ellipsis-horizontal",3,"click",4,"ngIf"],["name","ellipsis-horizontal",3,"click"]],template:function(t,n){1&t&&(m.Mb(0,"ion-header"),m.Mb(1,"ion-toolbar"),m.Mb(2,"ion-buttons",0),m.Ib(3,"ion-menu-button"),m.Lb(),m.Mb(4,"ion-item",1),m.Mb(5,"ion-title",2),m.oc(6),m.Xb(7,"translate"),m.Lb(),m.Mb(8,"ion-icon",3),m.Ub("click",function(){return n.openModal()}),m.Lb(),m.Lb(),m.Lb(),m.Lb(),m.Mb(9,"ion-content"),m.Mb(10,"ion-grid"),m.Mb(11,"ion-row"),m.mc(12,x,5,4,"ion-col",4),m.Lb(),m.Lb(),m.mc(13,_,7,5,"ion-card",5),m.Lb()),2&t&&(m.xb(6),m.qc(" ",m.Yb(7,3,"home.chordmaker")," "),m.xb(6),m.bc("ngForOf",n.tiles),m.xb(1),m.bc("ngForOf",n.chords))},directives:[c.q,c.M,c.e,c.y,c.t,c.K,c.r,c.l,c.p,c.E,o.h,c.k,c.d,c.J,c.f,c.h,c.j,o.i,c.i,c.g],pipes:[s.c,u.a],styles:[".col-tiles[_ngcontent-%COMP%]{text-transform:none;height:14%}.button-tiles[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;--border-radius:5px;border-radius:5px;margin:auto;height:100%;border:1px solid grey}.button-title[_ngcontent-%COMP%]{font-size:5vmin;font-weight:400}.card-subtitle[_ngcontent-%COMP%]{font-size:4.5vmin;font-weight:400}.card-content[_ngcontent-%COMP%]{font-size:4vmin;font-weight:400}ion-grid[_ngcontent-%COMP%]{height:70%}ion-row[_ngcontent-%COMP%]{height:100%}"]}),t})(),T=(()=>{class t{}return t.\u0275mod=m.Fb({type:t}),t.\u0275inj=m.Eb({factory:function(n){return new(n||t)},providers:[c.Q],imports:[[o.b,e.a,c.N,a.i.forChild([{path:"",component:q}]),l.a,s.b.forChild({loader:{provide:s.a,useFactory:b.HttpLoaderFactory,deps:[r.a]}})]]}),t})()}}]);